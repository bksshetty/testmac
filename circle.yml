machine:
  xcode:
    version: "6.4"
dependencies:
  pre:
    - sudo gem install rubygems-update
    - sudo gem install shenzhen
    - sudo gem install highline --version 1.7.2
test:
  override:
    - xctool
      -reporter pretty
      -reporter junit:$CIRCLE_TEST_REPORTS/xcode/results.xml
      -reporter plain:$CIRCLE_ARTIFACTS/xctool.log
      CODE_SIGNING_REQUIRED=YES
      CODE_SIGN_IDENTITY="security import ./scripts/dist.p12 -k ~/Library/Keychains/ios-build.keychain -P $KEY_PASSWORD -T /usr/bin/codesign"
      PROVISIONING_PROFILE="security import ./scripts/dist.cer -k ~/Library/Keychains/ios-build.keychain -T /usr/bin/codesign"
      -sdk iphonesimulator
      -scheme "ClarksCollection"
      build
test:
  override:
    - ./scripts/add-key.sh
    - ipa build -c Distribution
    - ./scripts/remove-key.sh
deployment:
  hockey:
    branch: master
    commands:
      - ipa distribute:crashlytics -c Crashlytics.framework -a API_KEY -s BUILD_SECRET